<view class="unified-history-container">
  <view class="history-title">{{title || 'æ‰“å¡å†å²è®°å½•'}}</view>
  
  <view class="unified-history-list">
    <!-- æ‰€æœ‰è®°å½•æŒ‰æ—¶é—´æ··æ’æ˜¾ç¤º -->
    <block wx:if="{{hasRecords}}">
      <block wx:for="{{sortedRecords}}" wx:key="timestamp">
        <view class="unified-history-item {{item.type}}-type">
          <view class="history-header">
            <view class="history-info">
              <text class="history-type">{{item.type === 'text' ? 'æ–‡å­—' : item.type === 'image' ? 'å›¾ç‰‡' : 'è¯­éŸ³'}}</text>
              <text class="history-index">#{{item.index}}</text>
            </view>
            <text class="history-time">{{item.timeFormatted || item.time}}</text>
          </view>
          <view class="history-content">
            <!-- æ ¹æ®è®°å½•ç±»å‹æ˜¾ç¤ºä¸åŒå†…å®¹ -->
            <block wx:if="{{item.type === 'text'}}">
              <text class="history-text">{{item.content || item.displayContent}}</text>
            </block>
            
            <block wx:elif="{{item.type === 'image'}}">
              <image 
                class="history-image" 
                src="{{item.content || item.displayContent || item.imgSrc}}" 
                mode="aspectFill" 
                bindtap="onImageTap" 
                data-src="{{item.content || item.displayContent || item.imgSrc}}"
              ></image>
              <view class="image-hint">ç‚¹å‡»æŸ¥çœ‹å¤§å›¾</view>
            </block>
            
            <block wx:elif="{{item.type === 'audio'}}">
              <view 
                class="audio-player-history {{currentPlayingAudio === (item.content || item.displayContent || item.audioSrc) ? 'playing' : ''}}" 
                bindtap="onAudioTap" 
                data-src="{{item.content || item.displayContent || item.audioSrc}}"
                data-duration="{{item.duration}}"
              >
                <view class="audio-icon">ğŸ”Š</view>
                <view class="audio-duration">{{item.duration || '00:15'}}</view>
                <view class="audio-status">{{currentPlayingAudio === (item.content || item.displayContent || item.audioSrc) ? 'æ’­æ”¾ä¸­...' : 'ç‚¹å‡»æ’­æ”¾'}}</view>
              </view>
            </block>
          </view>
        </view>
      </block>
    </block>
    
    <!-- æ²¡æœ‰è®°å½•æ—¶æ˜¾ç¤ºæç¤º -->
    <view wx:else class="no-records">
      <text>{{emptyText || 'æš‚æ— æ‰“å¡è®°å½•'}}</text>
    </view>
  </view>
</view> 